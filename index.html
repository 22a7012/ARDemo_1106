<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Marker Hold AR (Static)</title>

    <!-- A-Frameæœ¬ä½“ -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

    <!-- AR.jsæ‹¡å¼µ -->
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- ãƒãƒ¼ã‚«ãƒ¼ -->
      <a-marker preset="hiro" id="hiroMarker">
        <!-- ãƒ¢ãƒ‡ãƒ«ï¼ˆæœ€åˆã¯ãƒãƒ¼ã‚«ãƒ¼ä¸Šï¼‰ -->
        <a-entity
          id="myModel"
          gltf-model="url(chaei.glb)"
          scale="0.5 0.5 0.5"
          position="0 0 0"
          rotation="0 180 0">
        </a-entity>
      </a-marker>

      <!-- ã‚«ãƒ¡ãƒ© -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const marker = document.querySelector("#hiroMarker");
      const model = document.querySelector("#myModel");

      let hasPlaced = false; // ä¸€åº¦ã§ã‚‚ãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹ã¤ã‹ã£ãŸã‹
      let savedPosition = new THREE.Vector3();
      let savedRotation = new THREE.Euler();

      // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºæ™‚
      marker.addEventListener("markerFound", () => {
        console.log("ğŸ“ Marker detected!");
        if (!hasPlaced) {
          model.object3D.visible = true;
        }
      });

      // ãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹ãˆãªããªã£ãŸæ™‚
      marker.addEventListener("markerLost", () => {
        console.log("âŒ Marker lost!");
        if (!hasPlaced) {
          // ãƒ¢ãƒ‡ãƒ«ã®ç¾åœ¨ä½ç½®ã‚’ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã§ä¿å­˜
          model.object3D.getWorldPosition(savedPosition);
          model.object3D.getWorldRotation(savedRotation);

          // ãƒ¢ãƒ‡ãƒ«ã‚’ã‚·ãƒ¼ãƒ³ç›´ä¸‹ã«ç§»å‹•
          marker.sceneEl.appendChild(model);

          // ä¿å­˜ã—ãŸåº§æ¨™ã‚’é©ç”¨
          model.object3D.position.copy(savedPosition);
          model.object3D.rotation.copy(savedRotation);

          // ä»Šå¾Œã¯å›ºå®š
          hasPlaced = true;

          console.log("âœ… Model fixed in place!");
        }
      });
    </script>
  </body>
</html>
